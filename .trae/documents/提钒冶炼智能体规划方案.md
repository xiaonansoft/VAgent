## 目标与边界

* 核心目标：围绕“去钒保碳”，在全过程把熔池温度控制在动态临界温度以下（参考 1361℃基准），同时确保半钢碳含量目标（≥3.5%）与钒氧化率。

* 交互形态：Chat（意图驱动咨询/下发建议）+ Live Dashboard（实时数据曲线、告警、关键指标）。

* 安全边界：所有数值计算与判据只允许通过工具代码产出；LLM 仅负责意图识别、参数抽取、工具编排与解释说明；关键回答必须可追溯到检索证据片段。

## 系统总体架构（MCP）

* MCP Data Server：对接 PLC/DCS/化验室/L2 系统，统一以 MCP Resources 暴露数据流（温度、成分、枪位、吹炼事件、渣样化验等）。

* MCP Tools Server：封装热平衡、枪位曲线、临界温度预测、收得率诊断等计算逻辑为标准 MCP Tools。

* Agent Runtime：系统提示词（20年经验炼钢专家）+ 工况状态机（开吹前/过程/终点/出钢后）+ 事件驱动告警。

* RAG 知识库：挂载工艺材料 PDF/讲课稿，提供“证据检索”能力，支撑可解释回答与规程查询。

* 前端：Chat + 仪表盘（实时曲线/阈值/告警面板/操作清单），与 MCP Resources 订阅联动。

## 角色与工作模式（对应 PRD 场景）

* Copilot 模式（开吹前配料）：识别“配料/降温/枪位策略”意图，抽取 si、是否一罐到底、当前温度等，调用热平衡与枪位工具，输出可执行步骤与时序约束（如 2.5 分钟加完）。

* Monitor 模式（过程监控）：订阅温度与关键事件流，接近/超过临界温度自动触发告警与压温建议，并给出禁止动作（如严禁提枪）。

* Postmortem 模式（事后诊断）：根据渣成分、过程数据与关键时间点，输出钒低原因排序、证据引用与改进措施。

## Tools（Skills）落地清单（按 PRD 1-4）

* calculate\_thermal\_balance：输入 iron\_temp/si\_content/is\_one\_can，输出冷却剂结构与吨钢量、加料时机与风险提示。

* recommend\_lance\_profile：输入 si\_content，输出可机读的“枪位曲线/阶段参数/终点压枪动作”。

* predict\_critical\_temp：输入当前成分（至少 C/V）与温度，输出动态临界温度与裕度（T - Tcritical）。

* diagnose\_low\_yield：输入 slag\_analysis/process\_data，输出诊断结论、置信度、主要证据与建议。

## 数据模型与资源规划

* Resource 目录设计：

  * resource://plc/iron\_ladle/temperature（实时）

  * resource://lab/analysis/initial（初始成分：C, Si, V, Ti, P, S）

  * resource://plc/converter/lance\_height（实时）

  * resource://process/events（开吹、加料、压枪、出钢开始/结束）

  * resource://lab/analysis/slag（渣样：TFe, CaO, SiO2, V2O5…）

* Tool 输入输出统一 schema：时间戳、单位、来源、缺失值策略（缺失则拒绝计算并提示补数）。

## 可靠性与风控

* 幻觉控制：

  * 强制“工具优先”：涉及质量/温度/枪位/时间窗口等一律走工具。

  * 强制“引用证据”：规程类回答必须附带检索到的片段 ID/标题。

* 工况时效：对实时数据加“最大允许延迟”，超过阈值则标记为“数据不可信”并降级输出。

* 可追溯：记录每次建议所用输入、工具版本、输出与告警触发原因。

## 前端与交互设计

* Chat：支持一键补参数（缺温度/缺Si时引导点击选择），输出“操作清单（可复制）”。

* Dashboard：

  * 温度曲线 + 临界温度曲线 + 裕度显示

  * 枪位曲线（目标 vs 实际）

  * 告警列表（可确认/可追溯）

  * 本炉关键指标卡片（Si、是否一罐到底、累计冷料、吹氧时间等）

## 交付拆分（按可运行闭环）

* 闭环 1：Data Server（模拟数据源即可）+ Tools Server（4个核心工具）+ Chat（场景A可跑通）。

* 闭环 2：订阅温度流 + predict\_critical\_temp 告警（场景B可跑通）。

* 闭环 3：接入渣样/过程数据 + diagnose\_low\_yield（事后诊断可跑通）。

* 闭环 4：RAG 知识库 + “证据引用”出图（规程查询可跑通）。

## 验证与验收标准

* 单元测试：每个 Tool 覆盖典型 Si 区间、一罐到底修正、边界温度、缺失输入拒绝。

* 仿真回放：用历史炉次（脱敏）回放温度曲线，验证告警触发点与建议一致性。

* 可用性：场景A/B 输出必须包含明确操作动作、时序约束与风险点。

## 下一步我将要做的实现动作（待你确认后执行）

* 在仓库中创建 MCP Data Server/Tools Server 的最小可运行骨架与统一 schema。

* 按 PRD 实现 4 个 Tools 的代码与测试，并提供模拟数据源用于端到端演示。

* 做一个最小前端：Chat + 温度/临界温度曲线 + 告警面板，并接入 MCP 订阅。

